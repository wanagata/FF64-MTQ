#include "stm32f4xx_hal.h"
#include "stdio.h"

class NEWUART
{
public:
    NEWUART(USART_TypeDef *uartport, const uint32_t Timeout, uint32_t BuadRate = 115200) : _Timeout(Timeout), _baudrate(BuadRate)
    {
        this->_uart.Instance = uartport;
        this->_uart.Init.BaudRate = BuadRate;
        this->_uart.Init.WordLength = UART_WORDLENGTH_8B;
        this->_uart.Init.StopBits = UART_STOPBITS_1;
        this->_uart.Init.Parity = UART_PARITY_NONE;
        this->_uart.Init.Mode = UART_MODE_TX_RX;
        this->_uart.Init.HwFlowCtl = UART_HWCONTROL_NONE;
        this->_uart.Init.OverSampling = UART_OVERSAMPLING_16;
    }
    UART_HandleTypeDef* getHandleTypeDef() { return _uart; }
    void begin(const uint32_t BuadRate)
    {
        this->_uart.Init.BaudRate = BuadRate;
        if (HAL_UART_Init(_uart->Instance) != HAL_OK)
        {
            // Error_Handler();
        }
    }
    void writeByte(const uint8_t data)
    {
        HAL_UART_Transmit(this->_uart, data, sizeof(data), _Timeout);
    }

    uint8_t readByte()
    {
        uint8_t data;
        HAL_UART_Transmit(this->_uart, &data, 1, _Timeout);
        return data;
    }

private:
    UART_HandleTypeDef *_uart;
    uint32_t _baudrate;
    uint32_t _Timeout;
}
